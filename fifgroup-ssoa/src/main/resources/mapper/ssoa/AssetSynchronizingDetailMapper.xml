<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.id.fifgroup.ssoa.dao.AssetSynchronizingDetailMapper">
  <resultMap id="BaseResultMap" type="co.id.fifgroup.ssoa.dto.AssetSynchronizingDetailDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 13 19:09:01 ICT 2013.
    -->
    <id column="ASSET_SYNC_DTL_ID" jdbcType="DECIMAL" property="id" />
    <result column="ASSET_SYNC_ID" jdbcType="DECIMAL" property="assetSyncId" />
    <result column="PROCESS_TYPE_ID" jdbcType="DECIMAL" property="processTypeId" />
    <result column="PROCESS_TYPE_CODE" jdbcType="VARCHAR" property="processTypeCode" />
    <result column="ASSET_ID" jdbcType="DECIMAL" property="assetId" />
    <result column="STOCK_OPNAME_UNREG_ASSET_ID" jdbcType="DECIMAL" property="stockOpnameUnregAssetId" />
    <result column="EBS_RETIRE_STATUS" jdbcType="VARCHAR" property="ebsRetireStatus" />
    <result column="CREATED_BY" jdbcType="DECIMAL" property="createdBy" />
    <result column="CREATION_DATE" jdbcType="TIMESTAMP" property="creationDate" />
    <result column="LAST_UPDATE_BY" jdbcType="DECIMAL" property="lastUpdateBy" />
    <result column="LAST_UPDATE_DATE" jdbcType="TIMESTAMP" property="lastUpdateDate" />
  </resultMap>
  
  <resultMap id="CustomResultMap" type="co.id.fifgroup.ssoa.dto.AssetSynchronizingDetailDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 13 19:09:01 ICT 2013.
    -->
    <id column="ASSET_SYNC_DTL_ID" jdbcType="DECIMAL" property="id" />
    <result column="ASSET_SYNC_ID" jdbcType="DECIMAL" property="assetSyncId" />
    <result column="PROCESS_TYPE_ID" jdbcType="DECIMAL" property="processTypeId" />
    <result column="PROCESS_TYPE_CODE" jdbcType="VARCHAR" property="processTypeCode" />
    <result column="ASSET_ID" jdbcType="DECIMAL" property="assetId" />
    <result column="ASSET_NUMBER" jdbcType="DECIMAL" property="assetNumber" />
	<result column="SERIAL_NUMBER" jdbcType="VARCHAR" property="serialNumber" />
	
	<result column="BOOK_TYPE_CODE" jdbcType="VARCHAR" property="bookTypeCode" />
	<result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
	<result column="CATEGORY_ID" jdbcType="DECIMAL" property="categoryId" />
	<result column="CATEGORY_NAME" jdbcType="VARCHAR" property="categoryName" />
	<result column="BRANCH_ID" jdbcType="DECIMAL" property="branchId" />
	<result column="BRANCH_CODE" jdbcType="VARCHAR" property="branchCode" />
	<result column="BRANCH_NAME" jdbcType="VARCHAR" property="branchName" /> 
	<result column="LOCATION_CODE" jdbcType="VARCHAR" property="locationCode" />
	<result column="LOCATION_ID" jdbcType="DECIMAL" property="locationId" />
	<result column="LOCATION_NAME" jdbcType="VARCHAR" property="locationName" />
	<result column="DATE_PLACED_IN_SERVICE" jdbcType="DATE" property="datePlacedInService" />
	<result column="ORIGINAL_COST" jdbcType="DECIMAL" property="originalCost" />
	<result column="UNREVALUED_COST" jdbcType="DECIMAL" property="unrevaluedCost" />
	<result column="EBS_RETIRE_STATUS" jdbcType="VARCHAR" property="ebsRetireStatus" />
    <result column="LAST_UPDATE_BY" jdbcType="DECIMAL" property="lastUpdateBy" />
    <result column="LAST_UPDATE_DATE" jdbcType="TIMESTAMP" property="lastUpdateDate" />
    
    <result column="TRANSACTION_TYPE" jdbcType="VARCHAR" property="transactionType" />
    <result column="ASSET_TYPE" jdbcType="VARCHAR" property="assetType" />
  </resultMap>
  
  <select id="getAssetSynchronizingDetailDtoByAssetSynchronizingId" parameterType="map" resultMap="CustomResultMap">
		SELECT 	
			dtl.ASSET_SYNC_DTL_ID,
       dtl.ASSET_SYNC_ID,
       asset.ASSET_NUMBER,
       asset.SERIAL_NUMBER,
       asset.BOOK_TYPE_CODE,
       asset.ASSET_NUMBER,
       (SELECT description
          FROM bse_lookup_dependents
         WHERE detail_code = asset.asset_type_code AND ROWNUM = 1)
          AS ASSET_TYPE,
       (SELECT description
          FROM bse_lookup_dependents
         WHERE detail_code = dtl.process_type_code AND ROWNUM = 1)
          AS TRANSACTION_TYPE,
       (CASE
           WHEN asset.BRANCH_ID = -1
           THEN
              'HEADOFFICE'
           ELSE
              (SELECT SUBSTR (ORGANIZATION_CODE, -5) as branch_code
                 FROM WOS_ORGANIZATIONS
                WHERE ORGANIZATION_ID = asset.BRANCH_ID AND ROWNUM = 1)
        END)
          BRANCH_CODE,
       (CASE
           WHEN asset.BRANCH_ID = -1
           THEN
              'Head Office'
           ELSE
              (SELECT ORGANIZATION_NAME
                 FROM WOS_ORGANIZATIONS
                WHERE ORGANIZATION_ID = asset.BRANCH_ID AND ROWNUM = 1)
        END)
          BRANCH_NAME,
       asset.DESCRIPTION,
       cat.SEGMENT1 AS CATEGORY_NAME,
       asset.BRANCH_ID,
       loc.LOCATION_NAME,
       loc.LOCATION_CODE,
       asset.DATE_PLACED_IN_SERVICE,
       asset.ORIGINAL_COST,
       asset.UNREVALUED_COST,
       dtl.LAST_UPDATE_BY,
       dtl.LAST_UPDATE_DATE,
       (select status from fa_retirements@FIFGL.FIF.CO.ID where asset_id = asset.ebs_asset_id and rownum=1) EBS_RETIRE_STATUS
  FROM SOC_ASSET_SYNC_DTL dtl
       LEFT JOIN SOC_ASSETS asset ON asset.ASSET_ID = dtl.ASSET_ID
       LEFT JOIN SOC_EBS_CATEGORIES cat
          ON cat.CATEGORY_ID = asset.CATEGORY_ID
       LEFT JOIN WOS_LOCATIONS loc ON loc.LOCATION_ID = asset.LOCATION_ID
		<where>
			<if test="assetSynchronizingId != null">
				AND ASSET_SYNC_ID = #{assetSynchronizingId, jdbcType=DECIMAL}
			</if>			
		</where>
	</select>
	
	<select id="getCountAssetSynchronizingDetailDto" parameterType="map" resultType="int">
		SELECT
			COUNT(*)
		FROM
			SOC_ASSET_SYNC_DTL
		<!-- <where>
			<if test="systemPropertyCode != null">
				AND UPPER(SP.SYSTEM_PROPERTY_CODE) LIKE UPPER(#{systemPropertyCode, jdbcType=VARCHAR})
			</if>
			<if test="systemPropertyName != null">
				OR UPPER(SP.SYSTEM_PROPERTY_NAME) LIKE UPPER(#{systemPropertyName, jdbcType=VARCHAR})
			</if>
		</where> -->
	</select>
	
	
	<insert id="insert" parameterType="co.id.fifgroup.ssoa.domain.AssetSynchronizingDetail">
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Mar 19 22:59:29 ICT 2013.
	-->
	  <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
	    select SOC_ASSET_SYNC_DTL_S.nextVal from dual
	  </selectKey>
	  INSERT INTO SOC_ASSET_SYNC_DTL (ASSET_SYNC_DTL_ID,ASSET_SYNC_ID,ASSET_ID,
                                      CREATED_BY,CREATION_DATE,LAST_UPDATE_BY,LAST_UPDATE_DATE,PROCESS_TYPE_ID,PROCESS_TYPE_CODE)
	  values (#{id,jdbcType=DECIMAL}, #{assetSyncId,jdbcType=DECIMAL}, #{assetId,jdbcType=VARCHAR},
	    #{createdBy,jdbcType=DECIMAL}, #{creationDate,jdbcType=TIMESTAMP}, 
	    #{lastUpdateBy,jdbcType=DECIMAL}, #{lastUpdateDate,jdbcType=TIMESTAMP},#{processTypeId,jdbcType=DECIMAL},#{processTypeCode,jdbcType=VARCHAR})
	</insert>
  
</mapper>