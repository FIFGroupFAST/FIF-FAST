<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="co.id.fifgroup.ssoa.finder.AssetRegistrationFinder">
	<resultMap id="BaseResultMap" type="co.id.fifgroup.ssoa.dto.AssetRegistrationDTO">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Feb 27 
			20:51:34 ICT 2013. -->
		<id column="REGISTRATION_ID" jdbcType="DECIMAL" property="registrationId" />
		<result column="AVM_TRX_ID" jdbcType="VARCHAR" property="avmTrxIdString" />
	    <result column="COMPANY_ID" jdbcType="DECIMAL" property="companyId" />
	    <result column="BRANCH_ID" jdbcType="DECIMAL" property="branchId" />
	    <result column="REGISTRATION_NO" jdbcType="VARCHAR" property="registrationNo" />
	    <result column="REGISTRATION_DATE" jdbcType="DATE" property="registrationDate" />
	    <result column="BRANCH_CODE" jdbcType="VARCHAR" property="branchCode" />
	    <result column="BRANCH_NAME" jdbcType="VARCHAR" property="branchName" />
	    <result column="REMARKS" jdbcType="VARCHAR" property="remarks" />
	    <result column="STATUS_ID" jdbcType="DECIMAL" property="statusId" />
	    <result column="STATUS_CODE" jdbcType="VARCHAR" property="statusCode" />
	    <result column="CREATED_BY" jdbcType="DECIMAL" property="createdBy" />
	    <result column="CREATION_DATE" jdbcType="TIMESTAMP" property="creationDate" />
	    <result column="FULL_NAME" jdbcType="VARCHAR" property="fullName" />
	    <result column="LAST_UPDATE_DATE" jdbcType="TIMESTAMP" property="lastUpdateDate" />
	    <result column="DESCRIPTION" property="statusName" jdbcType="VARCHAR"/>
	    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
	</resultMap>

	<sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 19 22:59:29 ICT 2013.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  
	<select id="selectByExample" resultMap="BaseResultMap"
		parameterType="co.id.fifgroup.ssoa.domain.AssetRegistrationExample">
		SELECT DISTINCT
		AR.REGISTRATION_ID,
		AR.AVM_TRX_ID, 
	    AR.COMPANY_ID,
	    AR.BRANCH_ID, 
	    AR.REGISTRATION_NO, 
	    AR.REGISTRATION_DATE, 
	    AR.BRANCH_ID,
	    (case when AR.BRANCH_ID = -1 then 'HEADOFFICE' else (SELECT SUBSTR (ORGANIZATION_CODE, -5) as branch_code from WOS_ORGANIZATIONS where ORGANIZATION_ID = AR.BRANCH_ID and rownum = 1) end )BRANCH_CODE,
	    (case when AR.BRANCH_ID = -1 then 'Head Office' else (SELECT ORGANIZATION_NAME from WOS_ORGANIZATIONS where ORGANIZATION_ID = AR.BRANCH_ID and rownum = 1) end )BRANCH_NAME_ORIGIN,
	    (case when AR.REMARKS is null then '-' else AR.REMARKS end )REMARKS, 
	    AR.STATUS_ID,
	    AR.STATUS_CODE,
	    LD.DESCRIPTION, 
	    AR.CREATED_BY, 
	    AR.CREATION_DATE, 
	    AR.LAST_UPDATE_BY, 
	    AR.LAST_UPDATE_DATE,
	    (SELECT CONCAT(concat(PEA.EMPLOYEE_NUMBER,'-'),PEA.FULL_NAME) FROM pea_personal_informations PEA 
                        WHERE ROWNUM = 1 AND PEA.EMPLOYEE_NUMBER = U.USER_NAME) AS FULL_NAME,
		U.USER_NAME
		from SOC_REGISTRATION_HDR AR
		INNER JOIN BSE_LOOKUP_DEPENDENTS LD on LD.DETAIL_CODE = AR.STATUS_CODE 
		LEFT JOIN
			SAM_USERS U ON U.USER_ID = AR.LAST_UPDATE_BY
		INNER JOIN PEA_PERSONAL_INFORMATIONS PEA ON PEA.PERSON_ID = U.PERSON_ID
		<if test="_parameter != null">
      		<include refid="Example_Where_Clause" />
    	</if>
		<if test="orderByClause != null">
             order by ${orderByClause}
    	</if>

	</select>

	<select id="countByExample" resultType="int"
		parameterType="co.id.fifgroup.ssoa.domain.AssetTransferExample">
		SELECT count(*)
		FROM SOC_REGISTRATION_HDR AR
		LEFT JOIN SAM_USERS U ON U.USER_ID = AR.LAST_UPDATE_BY
		<if test="_parameter != null">
      		<include refid="Example_Where_Clause" />
    	</if>
		ORDER BY AR.LAST_UPDATE_DATE DESC
	</select>

	<!-- Start Searching Asset -->
	
	<resultMap id="BaseAssetResultMap" type="co.id.fifgroup.ssoa.domain.Assets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 19 22:59:29 ICT 2013.
    -->
        <id column="ASSET_ID" jdbcType="DECIMAL"
			property="id" />
		<result column="EBS_ASSET_ID" jdbcType="DECIMAL" property="ebsAssetId" />
        <result column="ASSET_NUMBER" jdbcType="VARCHAR" property="assetNumber" />
		<result column="TAG_NUMBER" jdbcType="DECIMAL" property="tagNumber" />
		<result column="SERIAL_NUMBER" jdbcType="VARCHAR" property="serialNumber" />
		<result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
		<result column="CATEGORY_ID" jdbcType="DECIMAL" property="categoryId" />
		<result column="COMPANY_ID" jdbcType="DECIMAL" property="companyId" />
		<result column="BRANCH_ID" jdbcType="DECIMAL" property="branchId" />
		<result column="BRANCH_CODE" jdbcType="VARCHAR" property="branchCode" />
		<result column="BRANCH_NAME" jdbcType="VARCHAR" property="branchName" />
		<result column="LOCATION_ID" jdbcType="VARCHAR" property="locationId" />
		<result column="POSITION" jdbcType="VARCHAR" property="position" />
		
		<result column="DATE_PLACED_IN_SERVICE" jdbcType="DATE" property="datePlacedInService" />
		<result column="LIFE_IN_MONTHS" jdbcType="DECIMAL" property="lifeInMonths" />
		
		<result column="ORIGINAL_COST" jdbcType="DECIMAL" property="originalCost" />
		<result column="UNREVALUED_COST" jdbcType="DECIMAL" property="unrevaluedCost" />
		<result column="BOOK_TYPE_CODE" jdbcType="VARCHAR" property="bookTypeCode" />
		<result column="LAST_PRINTED_DATE" jdbcType="TIMESTAMP" property="lastPrintedDate" />
		<result column="PRINTED_COUNT" jdbcType="DECIMAL" property="printedCount" />
		<result column="CREATED_BY" jdbcType="DECIMAL" property="createdBy" />
		<result column="CREATION_DATE" jdbcType="TIMESTAMP" property="creationDate" />
		<result column="LAST_UPDATE_BY" jdbcType="DECIMAL" property="lastUpdateBy" />
		<result column="LAST_UPDATE_DATE" jdbcType="TIMESTAMP" property="lastUpdateDate" />
		
		<result column="LOCATION_NAME" jdbcType="VARCHAR" property="locationName" />
		<result column="SO_RESULT" jdbcType="VARCHAR" property="stockOpnameResult" />
		<result column="SO_SUGEST" jdbcType="VARCHAR" property="stockOpnameSugest" />
		<result column="SO_HO_SUGEST" jdbcType="VARCHAR" property="stockOpnameHoSugest" />
  </resultMap>
  
  
  <select id="selectAssetByBranchId" resultMap="BaseAssetResultMap"
		parameterType="co.id.fifgroup.ssoa.domain.Assets">
		SELECT DISTINCT
	        A.ASSET_ID,
            A.EBS_ASSET_ID,
            A.ASSET_NUMBER,
            A.TAG_NUMBER,
            A.SERIAL_NUMBER,
            A.DESCRIPTION,
            A.CATEGORY_ID,
            A.COMPANY_ID,
            A.BRANCH_ID,
            (case when A.BRANCH_ID = -1 then 'HEADOFFICE' else (SELECT SUBSTR (ORGANIZATION_CODE, -5) as branch_code from WOS_ORGANIZATIONS where ORGANIZATION_ID = A.BRANCH_ID and rownum = 1) end )BRANCH_CODE,
    		(case when A.BRANCH_ID = -1 then 'Head Office' else (SELECT ORGANIZATION_NAME from WOS_ORGANIZATIONS where ORGANIZATION_ID = A.BRANCH_ID and rownum = 1) end )BRANCH_NAME,
            A.LOCATION_ID,
            A.POSITION,
            A.DATE_PLACED_IN_SERVICE,
            A.LIFE_IN_MONTHS,
            A.ORIGINAL_COST,
            A.UNREVALUED_COST,
            A.BOOK_TYPE_CODE,
            A.LAST_PRINTED_DATE,
            A.PRINTED_COUNT,
            A.CREATED_BY, 
            A.CREATION_DATE, 
            A.LAST_UPDATE_BY, 
            A.LAST_UPDATE_DATE/*,
            (select DISTINCT DESCRIPTION from BSE_LOOKUP_DEPENDENTS LD 
                  inner join SOC_STOCK_OPNAME_DTL SO on SO.OPNAME_RESULT_CODE= LD.DETAIL_CODE
                  where  
                      SO.ASSET_ID = A.ASSET_ID) AS SO_RESULT,    
	          (select DISTINCT DESCRIPTION from BSE_LOOKUP_DEPENDENTS LD 
	                  inner join SOC_STOCK_OPNAME_DTL SO on SO.OPNAME_SUGEST_CODE= LD.DETAIL_CODE
	                  where  
	                       SO.ASSET_ID = A.ASSET_ID) AS SO_SUGEST,
	          (select DISTINCT DESCRIPTION from BSE_LOOKUP_DEPENDENTS LD 
	                  inner join SOC_STOCK_OPNAME_DTL SO on SO.OPNAME_HO_SUGEST_CODE= LD.DETAIL_CODE
	                  where 
                       SO.ASSET_ID = A.ASSET_ID) AS SO_HO_SUGEST,
            (SELECT distinct wo2.ORGANIZATION_NAME LOCATION_NAME FROM
	            (SELECT bhv.organization_id, bhv.branch_id,
	                   wo.organization_name AS branch_name
	              FROM branch_hierarchy_v bhv, wos_organizations wo, wos_organization_versions wov
			            WHERE wo.organization_id = bhv.branch_id and bhv.organization_id = wov.organization_id and WOV.LEVEL_CODE ='POS'
			            CONNECT BY NOCYCLE PRIOR bhv.ORGANIZATION_ID = bhv.branch_id
			            ) tr , wos_organizations wo2
			      WHERE tr.organization_id = wo2.organization_id
			            and branch_id = #{example.branchId,jdbcType=DECIMAL} 
			            and tr.organization_id = a.location_id ) AS LOCATION_NAME*/
        FROM SOC_ASSETS A
	        LEFT JOIN SAM_USERS U ON U.USER_ID = A.LAST_UPDATE_BY
	        LEFT JOIN SOC_STOCK_OPNAME_DTL SO on SO.ASSET_ID = A.ASSET_ID
 		<where>
			A.BRANCH_ID = #{example.branchId,jdbcType=DECIMAL}
			 <if test="example.description != null">
				 AND UPPER(A.DESCRIPTION) LIKE 
				 (UPPER('%' || #{example.description, jdbcType=VARCHAR} ||'%'))
			</if>
		</where>
		ORDER BY
		 A.BRANCH_ID,
		 A.DESCRIPTION,
		 A.LAST_UPDATE_DATE DESC
	</select>

	<select id="countAssetByBranchId" resultType="int"
		parameterType="co.id.fifgroup.ssoa.domain.Assets">
		SELECT count(*)
		FROM SOC_ASSETS A
		LEFT JOIN SAM_USERS U ON U.USER_ID = A.LAST_UPDATE_BY
		LEFT JOIN SOC_EBS_LOCATIONS l on l.LOCATION_ID = A.LOCATION_ID
        INNER JOIN BRANCH_HIERARCHY_V BR on BR.BRANCH_ID = A.BRANCH_ID
        LEFT JOIN SOC_STOCK_OPNAME_DTL SO on SO.ASSET_ID = A.ASSET_ID
        LEFT JOIN BSE_LOOKUP_DEPENDENTS BLD1 on BLD1.DETAIL_CODE = SO.OPNAME_RESULT_CODE
        LEFT JOIN BSE_LOOKUP_DEPENDENTS BLD2 on BLD2.DETAIL_CODE = SO.OPNAME_SUGEST_CODE
        LEfT JOIN BSE_LOOKUP_DEPENDENTS BLD3 on BLD3.DETAIL_CODE = SO.OPNAME_HO_SUGEST_CODE
		<where>
			A.BRANCH_ID = #{example.branchId,jdbcType=DECIMAL}
			 <if test="example.description != null">
				 AND UPPER(A.DESCRIPTION) LIKE 
				 (UPPER('%' || #{example.description, jdbcType=VARCHAR} ||'%'))
			</if>
		</where>
		ORDER BY A.LAST_UPDATE_DATE DESC
	</select>
	
	<!-- Start Searching Asset -->
	
</mapper>